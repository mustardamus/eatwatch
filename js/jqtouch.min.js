(function(d){d.jQTouch=function(s){function t(a){if(h.length>1){var b=Math.min(parseInt(a||1,10),h.length-1);if(isNaN(b)&&typeof a==="string"&&a!="#")for(var c=1,e=h.length;c<e;c++)if("#"+h[c].id===a){b=c;break}if(isNaN(b)||b<1)b=1;a=h[0].animation;c=h[0].page;h.splice(0,b);x(c,h[0].page,a,true);return o}else{console.error("No pages in history.");return false}}function u(a,b){var c=h[0].page;if(typeof a==="string")a=d(a);if(typeof b==="string")for(var e=i.length-1;e>=0;e--)if(i[e].name===b){b=i[e]; break}if(x(c,a,b)){y(a,b);return o}else{console.error("Could not animate pages.");return false}}function z(a){var b=d(a.target);if(b.attr("nodeName")!=="A")b=b.parent("a");a=b.attr("target");var c=b.attr("hash"),e=null;if(v==false||!b.length){console.warn("Not able to tap element.");return false}if(b.attr("target")=="_blank"||b.attr("rel")=="external")return true;for(var g=i.length-1;g>=0;g--)if(b.is(i[g].selector)){e=i[g];break}if(a=="_webapp")window.location=b.attr("href");else if(b.is(f.backSelector))t(c); else if(c&&c!="#"){b.addClass("active");u(d(c).data("referrer",b),e)}else{b.addClass("loading active");A(b.attr("href"),{animation:e,callback:function(){b.removeClass("loading");setTimeout(d.fn.unselect,250,b)},$referrer:b})}return false}function y(a,b){var c=a.attr("id");h.unshift({page:a,animation:b,id:c})}function x(a,b,c,e){if(b.length===0){d.fn.unselect();console.error("Target element is missing.");return false}d(":focus").blur();scrollTo(0,0);var g=function(){if(c){b.removeClass("in reverse "+ c.name);a.removeClass("current out reverse "+c.name)}else a.removeClass("current");b.trigger("pageAnimationEnd",{direction:"in"});a.trigger("pageAnimationEnd",{direction:"out"});clearInterval(dumbLoop);j=b;location.hash=j.attr("id");B();var n=b.data("referrer");n&&n.unselect();C=(new Date).getTime();v=true};a.trigger("pageAnimationStart",{direction:"out"});b.trigger("pageAnimationStart",{direction:"in"});if(d.support.WebKitAnimationEvent&&c&&f.useAnimations){b.one("webkitAnimationEnd",g);v=false; b.addClass(c.name+" in current "+(e?" reverse":""));a.addClass(c.name+" out"+(e?" reverse":""))}else{b.addClass("current");g()}return true}function B(){dumbLoop=setInterval(function(){var a=j.attr("id");if(location.hash=="")location.hash="#"+a;else if(location.hash!="#"+a)try{t(location.hash)}catch(b){console.error("Unknown hash change.")}},100)}function J(a,b){var c=null;d(a).each(function(){var e=d(this);e.attr("id")||e.attr("id","page-"+ ++K);e.appendTo(k);if(e.hasClass("current")||!c)c=e});if(c!== null){u(c,b);return c}else return false}function A(a,b){var c=d.extend({},{data:null,method:"GET",animation:null,callback:null,$referrer:null},b);if(a!="#")d.ajax({url:a,data:c.data,type:c.method,success:function(e){if(e=J(e,c.animation)){c.method=="GET"&&f.cacheGetRequests&&c.$referrer&&c.$referrer.attr("href","#"+e.attr("id"));c.callback&&c.callback(true)}},error:function(){c.$referrer&&c.$referrer.unselect();c.callback&&c.callback(false)}});else $referrer&&$referrer.unselect()}function D(a,b){var c= typeof a==="string"?d(a):d(a.target);if(c.length&&c.is(f.formSelector)&&c.attr("action")){A(c.attr("action"),{data:c.serialize(),method:c.attr("method")||"POST",animation:i[0]||null,callback:b});return false}return true}function L(){var a=d(this).closest("form");if(a.length){evt=jQuery.Event("submit");evt.preventDefault();a.trigger(evt);return false}return true}function E(a){if(typeof a.selector=="string"&&typeof a.name=="string"){i.push(a);d(a.selector).tap(z);l.push(a.selector)}}function M(){q= window.innerWidth<window.innerHeight?"profile":"landscape";k.removeClass("profile landscape").addClass(q).trigger("turn",{orientation:q})}function N(a){function b(){e();var p=Math.abs(r),F=Math.abs(w);if(p>F&&p>35&&G<1E3)g.trigger("swipe",{direction:r<0?"left":"right"}).unbind("touchmove touchend");else F>1&&g.removeClass("active");clearTimeout(n)}function c(){e();if(w===0&&r===0){g.makeActive();g.trigger("tap")}else g.removeClass("active");g.unbind("touchmove touchend");clearTimeout(n)}function e(){var p= event.changedTouches[0]||null;r=p.pageX-O;w=p.pageY-P;G=(new Date).getTime()-Q}var g=d(a.target);if(!d(a.target).is(l.join(", "))){a=d(a.target).closest("a");if(a.length)g=a;else return}if(event){var n=null,O=event.changedTouches[0].clientX,P=event.changedTouches[0].clientY,Q=(new Date).getTime(),r=0,w=0,G=0;g.bind("touchmove",b).bind("touchend",c);n=setTimeout(function(){g.makeActive()},100)}}d.support.WebKitCSSMatrix=typeof WebKitCSSMatrix=="object";d.support.touch=typeof Touch=="object";d.support.WebKitAnimationEvent= typeof WebKitTransitionEvent=="object";var k,R=d("head"),h=[],K=0,f={},j,q;/ Mobile\//.test(navigator.userAgent);var v=true,C=0,l=[],o={},H=d.jQTouch.prototype.extensions,I=["slide","flip","slideup","swap","cube","pop","dissolve","fade","back"],i=[],m="";(function(a){f=d.extend({},{addGlossToIcon:true,backSelector:".back, .cancel, .goback",cacheGetRequests:true,cubeSelector:".cube",dissolveSelector:".dissolve",fadeSelector:".fade",fixedViewport:true,flipSelector:".flip",formSelector:"form",fullScreen:true, fullScreenClass:"fullscreen",icon:null,touchSelector:"a, .touch",popSelector:".pop",preloadImages:false,slideSelector:"body > * > ul li a",slideupSelector:".slideup",startupScreen:null,statusBar:"default",submitSelector:".submit",swapSelector:".swap",useAnimations:true,useFastTouch:true},a);if(f.preloadImages)for(a=f.preloadImages.length-1;a>=0;a--)(new Image).src=f.preloadImages[a];if(f.icon)m+='<link rel="apple-touch-icon'+(f.addGlossToIcon?"":"-precomposed")+'" href="'+f.icon+'" />';if(f.startupScreen)m+= '<link rel="apple-touch-startup-image" href="'+f.startupScreen+'" />';if(f.fixedViewport)m+='<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"/>';if(f.fullScreen){m+='<meta name="apple-mobile-web-app-capable" content="yes" />';if(f.statusBar)m+='<meta name="apple-mobile-web-app-status-bar-style" content="'+f.statusBar+'" />'}m&&R.append(m);d(document).bind("ready",function(){for(var b in H){var c=H[b];d.isFunction(c)&&d.extend(o,c(o))}for(b in I){c= I[b];var e=f[c+"Selector"];typeof e=="string"&&E({name:c,selector:e})}l.push("input");l.push(f.touchSelector);l.push(f.backSelector);l.push(f.submitSelector);d(l.join(", ")).css("-webkit-touch-callout","none");d(f.backSelector).tap(z);d(f.submitSelector).tap(L);k=d("body");f.fullScreenClass&&window.navigator.standalone==true&&k.addClass(f.fullScreenClass+" "+f.statusBar);k.bind("touchstart",N).bind("orientationchange",M).trigger("orientationchange").submit(D);if(f.useFastTouch&&d.support.touch){k.click(function(g){g= d(g.target);return g.attr("target")=="_blank"||g.attr("rel")=="external"||g.is('input[type="checkbox"]')?true:false});k.mousedown(function(){if((new Date).getTime()-C<200)return false})}if(d("body > .current").length==0)j=d("body > *:first");else{j=d("body > .current:first");d("body > .current").removeClass("current")}d(j).addClass("current");location.hash=d(j).attr("id");y(j);scrollTo(0,0);B()})})(s);d.fn.unselect=function(a){a?a.removeClass("active"):d(".active").removeClass("active")};d.fn.makeActive= function(){return d(this).addClass("active")};d.fn.swipe=function(a){if(d.isFunction(a))return this.each(function(b,c){d(c).bind("swipe",a)})};d.fn.tap=function(a){if(d.isFunction(a)){var b=f.useFastTouch&&d.support.touch?"tap":"click";return d(this).live(b,a)}else d(this).trigger("tap")};return o={getOrientation:function(){return q},goBack:t,goTo:u,addAnimation:E,submitForm:D}};d.jQTouch.prototype.extensions=[];d.jQTouch.addExtension=function(s){d.jQTouch.prototype.extensions.push(s)}})(jQuery);